<h2 class="mb-4">Configurações do Sistema</h2>
<div class="card settings-card mb-4">
    <div class="card-body">
        <h4 class="card-title mb-4">Configurações Globais de Sessão</h4>
        <form id="globalSettingsForm">
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label for="globalMaxSessions" class="form-label">Limite de Sessões Padrão</label>
                    <input type="number" id="globalMaxSessions" class="form-control" min="1" required>
                </div>
                <div class="col-md-6">
                    <label for="globalSessionDuration" class="form-label">Duração da Sessão (minutos)</label>
                    <input type="number" id="globalSessionDuration" class="form-control" min="1" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Salvar Configurações</button>
        </form>
        <div id="globalSettingsMessage" class="mt-3"></div>
    </div>
</div>

<div class="card settings-card mb-4">
    <div class="card-body">
        <h4 class="card-title mb-4">Gerenciamento de Logs</h4>
        <p class="text-danger">Atenção: Esta ação irá apagar permanentemente todos os logs do sistema.</p>
        <button id="resetLogsBtn" class="btn btn-danger">
            <i class="fas fa-trash-alt me-2"></i>Resetar Todos os Logs
        </button>
    </div>
</div>

<div class="card settings-card">
    <div class="card-body">
        <h4 class="card-title mb-4">Gerenciamento de Sessões</h4>
        <p class="text-danger">Esta ação encerra todas as sessões ativas.</p>
        <button id="resetSessionsBtn" class="btn btn-warning">
            <i class="fas fa-power-off me-2"></i>Resetar Sessões
        </button>
    </div>
</div>

<!-- Reset Logs Confirmation Modal -->
<div class="modal fade" id="resetLogsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar Reset de Logs</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Você tem certeza que deseja apagar todos os logs do sistema? Esta ação não pode ser desfeita.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="confirmResetLogs">Confirmar Reset</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const globalSettingsForm = document.getElementById('globalSettingsForm');
        const resetLogsBtn = document.getElementById('resetLogsBtn');
        const resetLogsModal = new bootstrap.Modal(document.getElementById('resetLogsModal'));
        const confirmResetLogsBtn = document.getElementById('confirmResetLogs');
        const resetSessionsBtn = document.getElementById('resetSessionsBtn');

        const maxSessionsInput = document.getElementById('globalMaxSessions');
        const sessionDurationInput = document.getElementById('globalSessionDuration');
        maxSessionsInput.value = <%= globalSettings.maxSessions %>;
        sessionDurationInput.value = <%= globalSettings.sessionDuration %>;

        globalSettingsForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const maxSessions = parseInt(maxSessionsInput.value);
            const sessionDuration = parseInt(sessionDurationInput.value);
            try {
                const response = await fetch('/admin/settings/global', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ maxSessions, sessionDuration })
                });
                if (response.ok) {
                    showMessage('globalSettingsMessage', 'Configurações salvas com sucesso!', 'success');
                } else {
                    showMessage('globalSettingsMessage', 'Erro ao salvar configurações.', 'danger');
                }
            } catch (error) {
                showMessage('globalSettingsMessage', 'Erro ao salvar configurações.', 'danger');
            }
        });


        resetLogsBtn.addEventListener('click', () => resetLogsModal.show());

        confirmResetLogsBtn.addEventListener('click', async function() {
            try {
                const response = await fetch('/admin/settings/reset-logs', { method: 'POST' });
                if (response.ok) {
                    resetLogsModal.hide();
                    location.reload();
                } else {
                    alert('Erro ao resetar logs.');
                }
            } catch (error) {
                alert('Erro ao resetar logs.');
            }
        });

        resetSessionsBtn.addEventListener('click', async function() {
            if(confirm('Deseja encerrar todas as sessões ativas?')) {
                try {
                    const response = await fetch('/admin/settings/reset-sessions', { method: 'POST' });
                    if (response.ok) {
                        alert('Sessões resetadas');
                    } else {
                        alert('Erro ao resetar sessões');
                    }
                } catch (error) {
                    alert('Erro ao resetar sessões');
                }
            }
        });

        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.className = `alert alert-${type} mt-3`;
            element.textContent = message;
            setTimeout(() => element.remove(), 3000);
        }
    });
</script>
